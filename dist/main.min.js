!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).BloggerPager=e()}(this,(function(){"use strict";const t={pagerSelector:"#blog-pager",numberSelector:"#pager-numbers",numberClass:"pager-item",dotsClass:"pager-dots",activeClass:"is-active",totalVisibleNumbers:5,checkForUpdates:!0,byDate:"false",maxResults:null,query:null,label:null,start:null,updatedMax:null};function e({config:t,currentPage:e,totalPages:n}){const{totalVisibleNumbers:s,activeClass:a}=t,r=function({currentPage:t,totalPages:e,totalVisibleNumbers:n}){const s=e,a=Math.floor(n/2);let r=Math.max(t-a,1),o=Math.min(r+n-1,s);return s<=n?(r=1,o=s):t<=a?(r=1,o=n):t>=s-a&&(r=s-n+1,o=s),Array.from({length:o-r+1},((t,e)=>r+e))}({currentPage:e,totalVisibleNumbers:s,totalPages:n}),o={number:"..."},l=r.map((t=>({number:t,activeClass:t===e?a:""})));if(e>1&&!r.includes(1)){const t={number:1,activeClass:""};l.unshift(o),l.unshift(t)}if(e<n&&!r.includes(n)){const t={number:n,activeClass:""};l.push(o),l.push(t)}return l}function n(t){const e=t.searchParams,n=t.pathname,s=Object.fromEntries(["max-results","by-date","updated-max","start","q"].map((t=>{const n="q"===t?"query":t.replace(/-([a-z])/g,((t,e)=>e.toUpperCase()));const s=e.get(t);return null!==s?[n,s]:null})).filter(Boolean)),a=(r=n).includes("/search/label/")?r.split("/").pop():null;var r;return a&&(s.label=a),s}function s(t){const e=Array.from(t.querySelectorAll("a")).find((t=>t.href.includes("max-results=")));if(!e)return{};const n=new URL(e.href).searchParams.get("max-results");return{maxResults:Number(n)}}function a(t){let e=5381;for(let n=0;n<t.length;n++)e=33*e^t.charCodeAt(n);return(e>>>0).toString(36)}function r(t=null,e=null){return t?`postData-query${a(t)}`:e?`postData-label${a(e)}`:"postData"}function o(t,e,n){const s=r(e,n);localStorage.setItem(s,JSON.stringify(t))}function l(t,e){const n=r(t,e);return JSON.parse(localStorage.getItem(n))||{}}function u({config:t,number:e,postDates:n}){const{homeUrl:s,label:a,query:r,maxResults:o,byDate:l}=t;if(1===e)return function({homeUrl:t,label:e,query:n,maxResults:s,byDate:a}){return e?`${t}/search/label/${e}?max-results=${s}`:n?`${t}/search?q=${n}&max-results=${s}&by-date=${a}`:t}({homeUrl:s,label:a,query:r,maxResults:o,byDate:l});const u=function(t,e,n){const s=(t-1)*n-1;return Array.isArray(e)&&e[s]?encodeURIComponent(e[s]):null}(e,n,o);return u?`${s}${function(t,e){return t?`/search/label/${t}?`:e?`/search?q=${e}&`:"/search?"}(a,r)}updated-max=${u}&max-results=${o}&start=${(e-1)*o}&by-date=${l}`:"#fetching"}function i({config:t,paginationData:e,postDates:n}){if(!e.length)return;const{numberContainer:s,numberClass:a,dotsClass:r}=t,o=document.createDocumentFragment();e.forEach((e=>{o.appendChild("..."===e.number?(()=>{const t=document.createElement("span");return t.className=r,t.textContent="...",t})():(({number:e,activeClass:s})=>{const r=document.createElement("a");return r.className=`${a} ${s}`.trim(),r.textContent=e,r.href=u({config:t,number:e,postDates:n}),r})(e))})),s.innerHTML="",s.appendChild(o)}function c({config:t,totalPosts:n,postDates:s}){const{maxResults:a}=t,r=function(t,e){return Math.ceil(Number(t)/e)}(n,a),o=function({config:t,postDates:e}){const{query:n,maxResults:s,updatedMax:a,start:r}=t;if(!a&&!r)return 1;const o=e.filter(((t,e)=>(e+1)%s==0)).indexOf(a);return(r&&n?Math.ceil(r/s)+1:null)??(-1!==o?o+2:null)??1}({config:t,postDates:s});i({config:t,paginationData:e({config:t,currentPage:o,totalPages:r}),postDates:s})}return class{constructor(e={}){this.currentUrl=new URL(window.location.href),this.config={...t,...e,...n(this.currentUrl),homeUrl:this.currentUrl.origin},this.pagerContainer=document.querySelector(this.config.pagerSelector),this.numberContainer=document.querySelector(this.config.numberSelector)}async init(){if(!this.pagerContainer||!this.numberContainer)return;const{query:t,label:e,homeUrl:n,checkForUpdates:a}=this.config,r=l(t,e),{totalPosts:u=0,postDates:i=[],blogUpdated:m}=r,f={...this.config,...s(this.pagerContainer),numberContainer:this.numberContainer},p=u&&i.length;if(p&&c({config:f,totalPosts:u,postDates:i}),p&&!a)return void(f.maxResults>=u&&this.pagerContainer.remove());const h=await async function({homeUrl:t,query:e,label:n}){const s=`${t}/feeds/posts/summary/${n?`-/${n}?`:"?"}alt=json&max-results=0`,a=await fetch(s),r=await a.json(),u=Number(r.feed.openSearch$totalResults.$t),i=r.feed.updated.$t,c=l(e,n);return e||(c.totalPosts=u),c.blogUpdated=i,o(c,e,n),{totalPosts:u,blogUpdated:i}}({homeUrl:n,query:t,label:e});if(h.blogUpdated!==m||!i.length){const t=await async function({config:t,totalPosts:e}){const{homeUrl:n,query:s,label:a,byDate:r}=t;if(0===e)return[];const u=Math.ceil(e/150);let i=0;const c=Array.from({length:u},((t,e)=>fetch(`${n}/feeds/posts/summary/${s?`?q=${s}&orderby=${!1===r?"relevance":"published"}&`:a?`-/${a}?`:"?"}alt=json&max-results=150&start-index=${150*e+1}`).then((t=>t.json())))),m=(await Promise.all(c)).flatMap((t=>(s&&(i+=Number(t.feed.openSearch$totalResults.$t)),t.feed.entry?.map((t=>t.published.$t.replace(/\.\d+/,"")))||[]))),f=l(s,a);return f.postDates=m,s&&(f.totalPosts=i),o(f,s,a),{totalPosts:s?i:e,postDates:m}}({config:f,totalPosts:h.totalPosts});c({config:f,totalPosts:t.totalPosts,postDates:t.postDates})}f.maxResults>=(u||h.totalPosts)&&this.pagerContainer.remove()}}}));