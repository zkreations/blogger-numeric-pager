!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).BloggerPager=e()}(this,(function(){"use strict";const t={pagerSelector:"#blog-pager",numberSelector:"#pager-numbers",numberClass:"pager-item",dotsClass:"pager-dots",activeClass:"is-active",totalVisibleNumbers:6,checkForUpdates:!0,enableDotsJump:!0,byDate:"false",maxResults:null,query:null,label:null,start:null,updatedMax:null};function e({config:t,currentPage:e,totalPages:n}){const{totalVisibleNumbers:a,activeClass:s}=t,r=function({currentPage:t,totalPages:e,totalVisibleNumbers:n}){const a=e,s=Math.floor(n/2);let r=Math.max(t-s,1),o=Math.min(r+n-1,a);return a<=n?(r=1,o=a):t<=s?(r=1,o=n):t>=a-s&&(r=a-n+1,o=a),Array.from({length:o-r+1},((t,e)=>r+e))}({currentPage:e,totalVisibleNumbers:a,totalPages:n}),o=Math.floor(a/2),l=t=>({number:t,isDots:!0}),u=r.map((t=>({number:t,activeClass:t===e?s:""})));if(e>1&&!r.includes(1)){const t=l(Math.max(r[0]+1-o,1)),e={number:1,activeClass:""};u.unshift(t),u.unshift(e)}if(e<n&&!r.includes(n)){const t=l(Math.min(r[r.length-1]+o,n)),e={number:n,activeClass:""};u.push(t),u.push(e)}return u}function n(t){const e=t.searchParams,n=t.pathname,a=Object.fromEntries(["max-results","by-date","updated-max","start","q"].map((t=>{const n="q"===t?"query":t.replace(/-([a-z])/g,((t,e)=>e.toUpperCase()));const a=e.get(t);return null!==a?[n,a]:null})).filter(Boolean)),s=(r=n).includes("/search/label/")?r.split("/").pop():null;var r;return s&&(a.label=s),a}function a(t){const e=Array.from(t.querySelectorAll("a")).find((t=>t.href.includes("max-results=")));if(!e)return{};const n=new URL(e.href).searchParams.get("max-results");return{maxResults:Number(n)}}function s(t){let e=5381;for(let n=0;n<t.length;n++)e=33*e^t.charCodeAt(n);return(e>>>0).toString(36)}function r(t=null,e=null){return t?`postData-query${s(t)}`:e?`postData-label${s(e)}`:"postData"}function o(t,e,n){const a=r(e,n);localStorage.setItem(a,JSON.stringify(t))}function l(t,e){const n=r(t,e);return JSON.parse(localStorage.getItem(n))||{}}function u(t,e){return Math.ceil(Number(t)/e)}function i({config:t,number:e,postDates:n}){const{homeUrl:a,label:s,query:r,maxResults:o,byDate:l}=t;if(1===e)return function({homeUrl:t,label:e,query:n,maxResults:a,byDate:s}){return e?`${t}/search/label/${e}?max-results=${a}`:n?`${t}/search?q=${n}&max-results=${a}&by-date=${s}`:t}({homeUrl:a,label:s,query:r,maxResults:o,byDate:l});const u=function(t,e,n){const a=(t-1)*n-1;return Array.isArray(e)&&e[a]?encodeURIComponent(e[a]):null}(e,n,o);return u?`${a}${function(t,e){return t?`/search/label/${t}?`:e?`/search?q=${e}&`:"/search?"}(s,r)}updated-max=${u}&max-results=${o}&start=${(e-1)*o}&by-date=${l}`:"#fetching"}function c({config:t,paginationData:n,postDates:a}){if(!n.length)return;const{numberContainer:s,numberClass:r,dotsClass:o,enableDotsJump:l}=t,m=document.createDocumentFragment(),f=n=>{const s=document.createElement(l?"button":"span");return s.className=o,s.textContent="...",s.dataset.page=n,l&&s.addEventListener("click",(s=>{s.preventDefault(),function({config:t,postDates:n,pageNumber:a}){const{maxResults:s}=t;c({config:t,paginationData:e({config:t,currentPage:a,totalPages:u(n.length,s)}),postDates:n})}({config:t,postDates:a,pageNumber:n})})),s};n.forEach((e=>{m.appendChild(e.isDots?f(e.number):(({number:e,activeClass:n})=>{const s=document.createElement("a");return s.className=`${r} ${n}`.trim(),s.textContent=e,s.href=i({config:t,number:e,postDates:a}),s})(e))})),s.innerHTML="",s.appendChild(m)}function m({config:t,totalPosts:n,postDates:a}){const{maxResults:s}=t,r=u(n,s),o=function({config:t,postDates:e}){const{query:n,maxResults:a,updatedMax:s,start:r}=t;if(!s&&!r)return 1;const o=e.filter(((t,e)=>(e+1)%a==0)).indexOf(s);return(r&&n?Math.ceil(r/a)+1:null)??(-1!==o?o+2:null)??1}({config:t,postDates:a});c({config:t,paginationData:e({config:t,currentPage:o,totalPages:r}),postDates:a})}return class{constructor(e={}){this.currentUrl=new URL(window.location.href),this.config={...t,...e,...n(this.currentUrl),homeUrl:this.currentUrl.origin},this.pagerContainer=document.querySelector(this.config.pagerSelector),this.numberContainer=document.querySelector(this.config.numberSelector)}async init(){if(!this.pagerContainer||!this.numberContainer)return;const{query:t,label:e,homeUrl:n,checkForUpdates:s}=this.config,r=l(t,e),{totalPosts:u=0,postDates:i=[],blogUpdated:c}=r,f={...this.config,...a(this.pagerContainer),numberContainer:this.numberContainer},p=u&&i.length;if(p&&m({config:f,totalPosts:u,postDates:i}),p&&!s)return void(f.maxResults>=u&&this.pagerContainer.remove());const g=await async function({homeUrl:t,query:e,label:n}){const a=`${t}/feeds/posts/summary/${n?`-/${n}?`:"?"}alt=json&max-results=0`,s=await fetch(a),r=await s.json(),u=Number(r.feed.openSearch$totalResults.$t),i=r.feed.updated.$t,c=l(e,n);return e||(c.totalPosts=u),c.blogUpdated=i,o(c,e,n),{totalPosts:u,blogUpdated:i}}({homeUrl:n,query:t,label:e});if(g.blogUpdated!==c||!i.length){const t=await async function({config:t,totalPosts:e}){const{homeUrl:n,query:a,label:s,byDate:r}=t;if(0===e)return[];const u=Math.ceil(e/150);let i=0;const c=Array.from({length:u},((t,e)=>fetch(`${n}/feeds/posts/summary/${a?`?q=${a}&orderby=${!1===r?"relevance":"published"}&`:s?`-/${s}?`:"?"}alt=json&max-results=150&start-index=${150*e+1}`).then((t=>t.json())))),m=(await Promise.all(c)).flatMap((t=>(a&&(i+=Number(t.feed.openSearch$totalResults.$t)),t.feed.entry?.map((t=>t.published.$t.replace(/\.\d+/,"")))||[]))),f=l(a,s);return f.postDates=m,a&&(f.totalPosts=i),o(f,a,s),{totalPosts:a?i:e,postDates:m}}({config:f,totalPosts:g.totalPosts});m({config:f,totalPosts:t.totalPosts,postDates:t.postDates})}f.maxResults>=(u||g.totalPosts)&&this.pagerContainer.remove()}}}));